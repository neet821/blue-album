# ğŸ—ï¸ é¡¹ç›®æ¶æ„åˆ†æ - ç¬¬3éƒ¨åˆ†

## ğŸ’ ä»£ç è´¨é‡åˆ†æ

### 4.1 ä»£ç è§„èŒƒ

#### åç«¯ä»£ç è´¨é‡ â­â­â­â­â˜†

**ä¼˜ç‚¹:**
- âœ… ä½¿ç”¨ç±»å‹æç¤º (Type Hints)
- âœ… Pydantic æ•°æ®éªŒè¯
- âœ… å‡½æ•°å‘½åæ¸…æ™°
- âœ… é€‚å½“çš„æ³¨é‡Š

**ç¤ºä¾‹ (crud.py):**
```python
def get_posts(
    db: Session, 
    skip: int = 0, 
    limit: int = 100, 
    author_id: Optional[int] = None
):
    """è·å–æ–‡ç« åˆ—è¡¨,æ”¯æŒæŒ‰ä½œè€…ç­›é€‰"""
    query = db.query(models.Post)
    if author_id:
        query = query.filter(models.Post.author_id == author_id)
    return query.offset(skip).limit(limit).all()
```

**æ”¹è¿›ç‚¹:**
- ğŸ’¡ ç¼ºå°‘ docstring è§„èŒƒ (Google/NumPy style)
- ğŸ’¡ ç¼ºå°‘ç±»å‹åˆ«å (TypeAlias)
- ğŸ’¡ é­”æ³•æ•°å­—åº”æå–ä¸ºå¸¸é‡

#### å‰ç«¯ä»£ç è´¨é‡ â­â­â­â˜†â˜†

**ä¼˜ç‚¹:**
- âœ… Composition API ä½¿ç”¨è§„èŒƒ
- âœ… ç»„ä»¶æ‹†åˆ†åˆç†
- âœ… å“åº”å¼æ•°æ®è®¾è®¡è‰¯å¥½

**ç¼ºç‚¹:**
- âŒ æ—  TypeScript - ç±»å‹ä¸å®‰å…¨
- âŒ ç¼ºå°‘ ESLint é…ç½®
- âŒ ç¼ºå°‘ä»£ç æ ¼å¼åŒ–å·¥å…· (Prettier)
- âŒ å¤§é‡ alert() - ç”¨æˆ·ä½“éªŒå·®

**æ”¹è¿›ç¤ºä¾‹:**
```javascript
// âŒ å½“å‰
alert('æ–‡ç« å‘å¸ƒæˆåŠŸ');

// âœ… æ”¹è¿›
import { ElMessage } from 'element-plus'
ElMessage.success('æ–‡ç« å‘å¸ƒæˆåŠŸ')
```

---

### 4.2 é”™è¯¯å¤„ç†

#### åç«¯é”™è¯¯å¤„ç† â­â­â­â˜†â˜†

**å½“å‰å®ç°:**
```python
@app.post("/api/posts")
def create_post(post: schemas.PostCreate, ...):
    # ç›´æ¥æŠ›å‡ºå¼‚å¸¸
    raise HTTPException(status_code=400, detail="...")
```

**é—®é¢˜:**
- âš ï¸ é”™è¯¯ä¿¡æ¯ä¸ç»Ÿä¸€
- âš ï¸ ç¼ºå°‘é”™è¯¯ç è§„èŒƒ
- âš ï¸ ç¼ºå°‘æ—¥å¿—è®°å½•

**æ”¹è¿›æ–¹æ¡ˆ:**
```python
# è‡ªå®šä¹‰å¼‚å¸¸ç±»
class BusinessException(Exception):
    def __init__(self, code: int, message: str):
        self.code = code
        self.message = message

# å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@app.exception_handler(BusinessException)
async def business_exception_handler(request, exc):
    return JSONResponse(
        status_code=exc.code,
        content={"code": exc.code, "message": exc.message}
    )
```

#### å‰ç«¯é”™è¯¯å¤„ç† â­â­â­â˜…â˜†

**ä¼˜ç‚¹:**
- âœ… Axios æ‹¦æˆªå™¨å¤„ç† 401
- âœ… è¶…æ—¶é”™è¯¯å‹å¥½æç¤º
- âœ… ç½‘ç»œé”™è¯¯å¤„ç†

**ç¼ºç‚¹:**
- âš ï¸ ç»„ä»¶ä¸­ try-catch è¿‡å¤š
- âš ï¸ é”™è¯¯æç¤ºæ–¹å¼ä¸ç»Ÿä¸€ (alert vs UI)
- âš ï¸ ç¼ºå°‘å…¨å±€é”™è¯¯è¾¹ç•Œ

---

### 4.3 å®‰å…¨æ€§è¯„ä¼°

| å®‰å…¨é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| SQL æ³¨å…¥ | âœ… å®‰å…¨ | ä½¿ç”¨ SQLAlchemy ORM |
| XSS æ”»å‡» | âš ï¸ é£é™© | Markdown æœªè¿‡æ»¤ |
| CSRF | âŒ ç¼ºå¤± | æ—  CSRF Token |
| å¯†ç å¼ºåº¦ | âš ï¸ ä¸€èˆ¬ | æœªå¼ºåˆ¶å¤æ‚åº¦ |
| æ•æ„Ÿä¿¡æ¯ | âœ… å®‰å…¨ | ä½¿ç”¨ .env |
| æ–‡ä»¶ä¸Šä¼  | âœ… æ— é£é™© | æœªå®ç°åŠŸèƒ½ |
| æƒé™æ§åˆ¶ | âœ… å®Œå–„ | admin/user åˆ†ç¦» |
| Token å®‰å…¨ | âš ï¸ é£é™© | localStorage å­˜å‚¨ |

**å…³é”®é£é™©:**

1. **XSS é£é™© (é«˜)**
```javascript
// âŒ å±é™© - PostDetailPage.vue
<div v-html="renderedContent"></div>

// âœ… å®‰å…¨
import DOMPurify from 'dompurify'
const clean = DOMPurify.sanitize(markdown)
```

2. **CSRF ç¼ºå¤± (ä¸­)**
```python
# æ·»åŠ  CSRF ä¸­é—´ä»¶
from starlette_csrf import CSRFMiddleware
app.add_middleware(CSRFMiddleware, secret="...")
```

3. **å¯†ç ç­–ç•¥ (ä½)**
```python
# æ·»åŠ å¯†ç éªŒè¯
def validate_password(password: str):
    if len(password) < 8:
        raise ValueError("å¯†ç è‡³å°‘8ä½")
    if not re.search(r'[A-Z]', password):
        raise ValueError("éœ€è¦å¤§å†™å­—æ¯")
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 5.1 åç«¯æ€§èƒ½

#### å½“å‰é—®é¢˜

**N+1 æŸ¥è¯¢:**
```python
# âŒ é—®é¢˜ä»£ç 
posts = db.query(Post).all()
for post in posts:
    author = post.author  # æ¯æ¬¡æŸ¥è¯¢ 1 æ¬¡
```

**è§£å†³æ–¹æ¡ˆ:**
```python
# âœ… ä½¿ç”¨ joinedload
posts = db.query(Post).options(
    joinedload(Post.author)
).all()
```

**æ•°æ®åº“ç´¢å¼•:**
```sql
-- å½“å‰: username, email æœ‰ç´¢å¼• âœ…
-- ç¼ºå¤±:
CREATE INDEX idx_posts_category ON posts(category);
CREATE INDEX idx_posts_created ON posts(created_at DESC);
CREATE INDEX idx_links_user_category ON website_links(user_id, category_id);
```

**æŸ¥è¯¢ä¼˜åŒ–:**
```python
# åˆ†é¡µä¼˜åŒ–
def get_posts_optimized(db, page=1, size=20):
    return db.query(Post)\
        .options(joinedload(Post.author))\
        .order_by(Post.created_at.desc())\
        .limit(size)\
        .offset((page-1)*size)\
        .all()
```

---

### 5.2 å‰ç«¯æ€§èƒ½

#### ä¼˜åŒ–æ¸…å•

**1. è·¯ç”±æ‡’åŠ è½½ âœ…**
```javascript
// å·²å®ç°
component: () => import('./views/PostsPage.vue')
```

**2. å›¾ç‰‡ä¼˜åŒ– âŒ**
```vue
<!-- éœ€è¦æ·»åŠ  -->
<img :src="url" loading="lazy" />
```

**3. è™šæ‹Ÿæ»šåŠ¨ âŒ**
```javascript
// æ–‡ç« åˆ—è¡¨è¿‡é•¿æ—¶
import { RecycleScroller } from 'vue-virtual-scroller'
```

**4. é˜²æŠ–èŠ‚æµ âš ï¸**
```javascript
// æœç´¢æ¡†åº”æ·»åŠ é˜²æŠ–
import { debounce } from 'lodash-es'
const searchDebounced = debounce(search, 300)
```

**5. ç¼“å­˜ç­–ç•¥ âŒ**
```javascript
// Pinia æŒä¹…åŒ–
import { createPersistedState } from 'pinia-plugin-persistedstate'
pinia.use(createPersistedState())
```

---

### 5.3 ç½‘ç»œä¼˜åŒ–

**HTTP ç¼“å­˜:**
```python
# é™æ€èµ„æºç¼“å­˜
from fastapi.responses import FileResponse

@app.get("/static/{file}")
def get_static(file: str):
    return FileResponse(
        f"static/{file}",
        headers={"Cache-Control": "public, max-age=31536000"}
    )
```

**Gzip å‹ç¼©:**
```python
from fastapi.middleware.gzip import GZipMiddleware
app.add_middleware(GZipMiddleware, minimum_size=1000)
```

**CDN éƒ¨ç½²:**
```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vendor': ['vue', 'vue-router', 'pinia'],
          'ui': ['element-plus']
        }
      }
    }
  }
}
```

---

**ç¬¬ä¸‰éƒ¨åˆ†å®Œæˆ âœ…**

ä¸‹ä¸€éƒ¨åˆ†: å¯ç»´æŠ¤æ€§ã€æµ‹è¯•ã€éƒ¨ç½²ã€æ€»ç»“å»ºè®®
