# ğŸ”’ è·¯ç”±ä¿æŠ¤å®Œæ•´æµ‹è¯•æŒ‡å—

**æ›´æ–°æ—¶é—´:** 2025å¹´10æœˆ19æ—¥  
**æµ‹è¯•ç›®æ ‡:** éªŒè¯æ‰€æœ‰å—ä¿æŠ¤è·¯ç”±æ­£ç¡®æ‹¦æˆªæœªæˆæƒè®¿é—®

---

## ğŸ“‹ å—ä¿æŠ¤çš„è·¯ç”±åˆ—è¡¨

| è·¯ç”± | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `/tools` | å·¥å…·é¡µé¢ | ğŸ†• æ–°å¢ä¿æŠ¤ |
| `/tools/links` | é“¾æ¥ç®¡ç† | âœ… å·²ä¿æŠ¤ |
| `/profile` | ä¸ªäººèµ„æ–™ | ğŸ†• æ–°å¢ä¿æŠ¤ |
| `/posts/new` | å‘è¡¨æ–‡ç«  | âœ… å·²ä¿æŠ¤ |
| `/posts/:id/edit` | ç¼–è¾‘æ–‡ç«  | âœ… å·²ä¿æŠ¤ |
| `/admin/users` | ç”¨æˆ·ç®¡ç† | âœ… å·²ä¿æŠ¤(éœ€ç®¡ç†å‘˜) |

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: æ—  Token è®¿é—® (è·¯ç”±å®ˆå«æ‹¦æˆª)

**ç›®çš„:** éªŒè¯è·¯ç”±å®ˆå«åœ¨ç”¨æˆ·æœªç™»å½•æ—¶æ­£ç¡®æ‹¦æˆª

**æµ‹è¯•æ­¥éª¤:**
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾
3. æ‰§è¡Œå‘½ä»¤åˆ é™¤ token:
   ```javascript
   localStorage.removeItem('token')
   ```
4. è®¿é—®ä»»ä¸€å—ä¿æŠ¤é¡µé¢:
   - http://localhost:5173/tools
   - http://localhost:5173/tools/links
   - http://localhost:5173/profile
   - http://localhost:5173/posts/new

**é¢„æœŸç»“æœ:**
- âœ… **ç«‹å³è·³è½¬** åˆ°ç™»å½•é¡µ (URL å˜ä¸º `/login?message=è¯·å…ˆç™»å½•`)
- âœ… ç™»å½•é¡µæ˜¾ç¤ºçº¢è‰²é”™è¯¯æç¤º: **"è¯·å…ˆç™»å½•"**
- âœ… Console æ˜¾ç¤ºè·¯ç”±å®ˆå«æ—¥å¿—:
  ```
  ğŸ›¡ï¸ è·¯ç”±å®ˆå«æ£€æŸ¥: { to: "/tools", requiresAuth: true, hasToken: false }
  âš ï¸ éœ€è¦è®¤è¯ä½†æ²¡æœ‰ token,è·³è½¬åˆ°ç™»å½•é¡µ
  ```

---

### åœºæ™¯ 2: å‡ Token è®¿é—® (API æ‹¦æˆªå™¨æ‹¦æˆª)

**ç›®çš„:** éªŒè¯å³ä½¿ç»•è¿‡è·¯ç”±å®ˆå«,API è¯·æ±‚ä¹Ÿä¼šè¢«æ‹¦æˆª

**æµ‹è¯•æ­¥éª¤:**
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾
3. æ‰§è¡Œå‘½ä»¤è®¾ç½®å‡ token:
   ```javascript
   localStorage.setItem('token', 'fake-token-test-12345')
   ```
4. è®¿é—®å—ä¿æŠ¤é¡µé¢:
   ```
   http://localhost:5173/tools
   ```
5. **é¢„æœŸ:** èƒ½å¤Ÿè¿›å…¥é¡µé¢ (å› ä¸ºè·¯ç”±å®ˆå«æ£€æµ‹åˆ° token å­˜åœ¨)
6. **å…³é”®æ­¥éª¤:** å°è¯•è§¦å‘ä»»æ„ API è¯·æ±‚:
   - åœ¨å·¥å…·é¡µé¢ç‚¹å‡» "é“¾æ¥ç®¡ç†å·¥å…·"
   - æˆ–å°è¯•å‘è¡¨æ–‡ç« 
   - æˆ–è®¿é—®ä¸ªäººèµ„æ–™

**é¢„æœŸç»“æœ:**
- âœ… é¡µé¢åˆå§‹å¯ä»¥è®¿é—® (è·¯ç”±å®ˆå«é€šè¿‡)
- âœ… è§¦å‘ API è¯·æ±‚æ—¶,åç«¯è¿”å› **401 Unauthorized**
- âœ… axios æ‹¦æˆªå™¨æ•è· 401 é”™è¯¯
- âœ… Console æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—:
  ```
  ========== æ‹¦æˆªå™¨æ•è·é”™è¯¯ ==========
  é”™è¯¯å¯¹è±¡: AxiosError
  å“åº”çŠ¶æ€: 401
  ğŸ”’ æ£€æµ‹åˆ° 401 é”™è¯¯,å¼€å§‹å¤„ç†...
  ğŸ“Š å½“å‰ token: fake-token-test-12345
  âœ… Token å·²æ¸…é™¤
  ğŸ”„ å‡†å¤‡è·³è½¬åˆ°ç™»å½•é¡µ
  ```
- âœ… è‡ªåŠ¨æ¸…é™¤å‡ token (æ‰§è¡Œ `localStorage.getItem('token')` è¿”å› `null`)
- âœ… è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ (URL å˜ä¸º `/login?message=ç™»å½•å·²è¿‡æœŸ,è¯·é‡æ–°ç™»å½•`)
- âœ… ç™»å½•é¡µæ˜¾ç¤ºçº¢è‰²é”™è¯¯æç¤º: **"ç™»å½•å·²è¿‡æœŸ,è¯·é‡æ–°ç™»å½•"**

---

### åœºæ™¯ 3: æ­£å¸¸ç™»å½•åè®¿é—® (åº”è¯¥é€šè¿‡)

**ç›®çš„:** éªŒè¯æ­£å¸¸ç”¨æˆ·ä¸å—å½±å“

**æµ‹è¯•æ­¥éª¤:**
1. è®¿é—® http://localhost:5173/login
2. ä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·åå¯†ç ç™»å½•
3. è®¿é—®ä»»ä¸€å—ä¿æŠ¤é¡µé¢

**é¢„æœŸç»“æœ:**
- âœ… æ‰€æœ‰å—ä¿æŠ¤é¡µé¢æ­£å¸¸è®¿é—®
- âœ… API è¯·æ±‚è‡ªåŠ¨æºå¸¦æ­£ç¡®çš„ token
- âœ… åŠŸèƒ½æ­£å¸¸ä½¿ç”¨

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### åˆ é™¤ Token
```javascript
localStorage.removeItem('token')
```

### è®¾ç½®å‡ Token
```javascript
localStorage.setItem('token', 'fake-token-test-12345')
```

### æ£€æŸ¥å½“å‰ Token
```javascript
console.log('å½“å‰ token:', localStorage.getItem('token'))
```

### æŸ¥çœ‹ Token å†…å®¹ (è§£ç )
```javascript
const token = localStorage.getItem('token')
if (token) {
  const payload = JSON.parse(atob(token.split('.')[1]))
  console.log('Token payload:', payload)
  console.log('è¿‡æœŸæ—¶é—´:', new Date(payload.exp * 1000))
} else {
  console.log('æ²¡æœ‰ token')
}
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: åˆ é™¤ token åæ²¡æœ‰è·³è½¬

**å¯èƒ½åŸå› :**
- ç¼“å­˜é—®é¢˜
- è·¯ç”±å®ˆå«æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ³•:**
1. ç¡¬åˆ·æ–°é¡µé¢: `Ctrl + Shift + R` (Windows) æˆ– `Cmd + Shift + R` (Mac)
2. æ£€æŸ¥ Console æ˜¯å¦æœ‰é”™è¯¯
3. ç¡®è®¤ token ç¡®å®å·²åˆ é™¤: `localStorage.getItem('token')` è¿”å› `null`

### é—®é¢˜ 2: å‡ token å¯ä»¥æ­£å¸¸ä½¿ç”¨

**å¯èƒ½åŸå› :**
- æ²¡æœ‰è§¦å‘ API è¯·æ±‚
- æ‹¦æˆªå™¨é…ç½®é”™è¯¯

**æ’æŸ¥æ­¥éª¤:**
1. ç¡®è®¤ç¡®å®ç‚¹å‡»äº†åŠŸèƒ½æŒ‰é’® (è§¦å‘ API)
2. æ‰“å¼€ **Network** æ ‡ç­¾,ç­›é€‰ **Fetch/XHR**
3. æŸ¥çœ‹æ˜¯å¦æœ‰ API è¯·æ±‚
4. æŸ¥çœ‹è¯·æ±‚çš„å“åº”çŠ¶æ€ç æ˜¯å¦ä¸º 401

### é—®é¢˜ 3: æ²¡æœ‰çœ‹åˆ°é”™è¯¯æç¤º

**å¯èƒ½åŸå› :**
- é¡µé¢å·²ç»æœ‰å…¶ä»–é”™è¯¯
- æ¶ˆæ¯è¢«è¦†ç›–

**è§£å†³æ–¹æ³•:**
1. åˆ·æ–°ç™»å½•é¡µ
2. æ£€æŸ¥ URL æ˜¯å¦åŒ…å« `?message=...`
3. æŸ¥çœ‹ç™»å½•é¡µé¡¶éƒ¨æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯æ¡†

---

## âœ… æµ‹è¯•æ£€æŸ¥è¡¨

å®Œæˆæ‰€æœ‰æµ‹è¯•å,ç¡®è®¤ä»¥ä¸‹é¡¹ç›®:

- [ ] **åœºæ™¯ 1 æµ‹è¯•å®Œæˆ**
  - [ ] åˆ é™¤ token åè®¿é—® `/tools` è¢«æ‹¦æˆª
  - [ ] åˆ é™¤ token åè®¿é—® `/profile` è¢«æ‹¦æˆª
  - [ ] åˆ é™¤ token åè®¿é—® `/posts/new` è¢«æ‹¦æˆª
  - [ ] æ‰€æœ‰æƒ…å†µéƒ½æ˜¾ç¤º "è¯·å…ˆç™»å½•" æ¶ˆæ¯

- [ ] **åœºæ™¯ 2 æµ‹è¯•å®Œæˆ**
  - [ ] å‡ token å¯ä»¥è¿›å…¥é¡µé¢
  - [ ] è§¦å‘ API åè¢«æ‹¦æˆª
  - [ ] Console æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
  - [ ] è‡ªåŠ¨æ¸…é™¤å‡ token
  - [ ] æ˜¾ç¤º "ç™»å½•å·²è¿‡æœŸ" æ¶ˆæ¯

- [ ] **åœºæ™¯ 3 æµ‹è¯•å®Œæˆ**
  - [ ] æ­£å¸¸ç™»å½•åå¯ä»¥è®¿é—®æ‰€æœ‰é¡µé¢
  - [ ] åŠŸèƒ½æ­£å¸¸ä½¿ç”¨

---

## ğŸ“Š æŠ€æœ¯å®ç°è¯´æ˜

### åŒå±‚é˜²æŠ¤æœºåˆ¶

#### ç¬¬ä¸€å±‚: è·¯ç”±å®ˆå« (router/index.js)
```javascript
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token');
  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);

  if (requiresAuth && !token) {
    // æ²¡æœ‰ token,æ‹¦æˆªè®¿é—®
    next({
      path: '/login',
      query: { message: 'è¯·å…ˆç™»å½•' }
    });
  } else {
    next();
  }
});
```

**ä¼˜ç‚¹:** 
- å¿«é€Ÿå“åº”,æ— éœ€ç­‰å¾… API è¯·æ±‚
- é˜²æ­¢æœªç™»å½•ç”¨æˆ·çœ‹åˆ°é¡µé¢å†…å®¹

**å±€é™:**
- åªæ£€æŸ¥ token **æ˜¯å¦å­˜åœ¨**
- ä¸éªŒè¯ token **æ˜¯å¦æœ‰æ•ˆ**
- æ— æ³•é˜²æ­¢ä½¿ç”¨å‡ token

#### ç¬¬äºŒå±‚: Axios æ‹¦æˆªå™¨ (utils/request.js)
```javascript
// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // åç«¯éªŒè¯å¤±è´¥,token æ— æ•ˆ
      const authStore = useAuthStore();
      authStore.logout();
      router.push({ 
        path: '/login', 
        query: { message: 'ç™»å½•å·²è¿‡æœŸ,è¯·é‡æ–°ç™»å½•' } 
      });
    }
    return Promise.reject(error);
  }
);
```

**ä¼˜ç‚¹:**
- åç«¯çœŸæ­£éªŒè¯ token æœ‰æ•ˆæ€§
- æ•è·æ‰€æœ‰ 401 é”™è¯¯
- è‡ªåŠ¨æ¸…ç†æ— æ•ˆ token

**é…åˆä½¿ç”¨:**
ä¸¤å±‚é˜²æŠ¤äº’è¡¥,ç¡®ä¿**æ— è®ºç”¨æˆ·å¦‚ä½•å°è¯•**,éƒ½æ— æ³•ç»•è¿‡è®¤è¯è®¿é—®å—ä¿æŠ¤èµ„æºã€‚

---

**æµ‹è¯•æ„‰å¿«! ğŸ‰**
