# âœ… æ•°æ®åº“è¡¨åˆ›å»º - ä¸€é”®æ‰§è¡Œ

## ğŸ“ æ•°æ®åº“ä¿¡æ¯
- **æ•°æ®åº“å**: `blue_local_db`  âœ… å·²æ›´æ­£
- **éœ€è¦åˆ›å»º**: 3ä¸ªè¡¨

---

## ğŸš€ ç«‹å³æ‰§è¡Œï¼ˆå¤åˆ¶ç²˜è´´åˆ° HeidiSQLï¼‰

### æ­¥éª¤1ï¼šæ‰“å¼€ HeidiSQL æŸ¥è¯¢çª—å£

ç‚¹å‡»å·¥å…·æ çš„ **"æŸ¥è¯¢"** æŒ‰é’®æˆ–æŒ‰ **F9**

### æ­¥éª¤2ï¼šå¤åˆ¶ç²˜è´´ä»¥ä¸‹ SQL å¹¶æ‰§è¡Œ

```sql
-- ===========================================
-- åŒæ­¥è§‚å½±åŠŸèƒ½ - æ•°æ®åº“è¡¨åˆ›å»º
-- æ•°æ®åº“: blue_local_db
-- ===========================================

USE blue_local_db;

-- åˆ›å»ºæˆ¿é—´è¡¨
CREATE TABLE IF NOT EXISTS sync_rooms (
    id INT PRIMARY KEY AUTO_INCREMENT,
    room_code VARCHAR(20) UNIQUE NOT NULL,
    room_name VARCHAR(100) NOT NULL,
    host_user_id INT NOT NULL,
    control_mode VARCHAR(20) DEFAULT 'host_only' NOT NULL,
    mode VARCHAR(20) DEFAULT 'link' NOT NULL,
    video_source TEXT,
    video_hash VARCHAR(64),
    current_time INT DEFAULT 0,
    is_playing BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (host_user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_room_code (room_code),
    INDEX idx_host_user (host_user_id),
    INDEX idx_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- åˆ›å»ºæˆå‘˜è¡¨
CREATE TABLE IF NOT EXISTS sync_room_members (
    id INT PRIMARY KEY AUTO_INCREMENT,
    room_id INT NOT NULL,
    user_id INT NOT NULL,
    nickname VARCHAR(50),
    is_verified BOOLEAN DEFAULT TRUE,
    joined_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (room_id) REFERENCES sync_rooms(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_room_member (room_id, user_id),
    INDEX idx_room_member (room_id, user_id),
    INDEX idx_user_rooms (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- åˆ›å»ºæ¶ˆæ¯è¡¨
CREATE TABLE IF NOT EXISTS sync_room_messages (
    id INT PRIMARY KEY AUTO_INCREMENT,
    room_id INT NOT NULL,
    user_id INT NOT NULL,
    message TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (room_id) REFERENCES sync_rooms(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_room_messages (room_id, created_at),
    INDEX idx_user_messages (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- éªŒè¯åˆ›å»ºç»“æœ
SELECT 
    TABLE_NAME as 'è¡¨å',
    TABLE_ROWS as 'è¡Œæ•°',
    CREATE_TIME as 'åˆ›å»ºæ—¶é—´'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'blue_local_db' 
  AND TABLE_NAME IN ('sync_rooms', 'sync_room_members', 'sync_room_messages');
```

### æ­¥éª¤3ï¼šæŸ¥çœ‹ç»“æœ

æ‰§è¡Œååº”è¯¥çœ‹åˆ°ï¼š

```
è¡¨å                    | è¡Œæ•° | åˆ›å»ºæ—¶é—´
-----------------------|------|------------------
sync_rooms             | 0    | 2025-10-19 XX:XX:XX
sync_room_members      | 0    | 2025-10-19 XX:XX:XX
sync_room_messages     | 0    | 2025-10-19 XX:XX:XX
```

---

## âœ… æˆåŠŸæ ‡å¿—

å¦‚æœçœ‹åˆ°ï¼š
- âœ… **3ä¸ªè¡¨éƒ½æ˜¾ç¤ºå‡ºæ¥**
- âœ… **æ²¡æœ‰æŠ¥é”™**
- âœ… **è¡Œæ•°ä¸º 0**ï¼ˆæ–°è¡¨ï¼‰

è¯´æ˜åˆ›å»ºæˆåŠŸï¼

---

## âŒ å¦‚æœé‡åˆ°é”™è¯¯

### é”™è¯¯1ï¼šæ•°æ®åº“ä¸å­˜åœ¨

```
Unknown database 'blue_local_db'
```

**è§£å†³**ï¼šå…ˆåˆ›å»ºæ•°æ®åº“
```sql
CREATE DATABASE IF NOT EXISTS blue_local_db 
CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE blue_local_db;
```

### é”™è¯¯2ï¼šusers è¡¨ä¸å­˜åœ¨

```
Cannot add foreign key constraint
```

**è§£å†³**ï¼šç¡®è®¤ users è¡¨å­˜åœ¨
```sql
SHOW TABLES LIKE 'users';
-- å¦‚æœæ²¡æœ‰ users è¡¨ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸»åº”ç”¨çš„åŸºç¡€è¡¨
```

### é”™è¯¯3ï¼šè¡¨å·²å­˜åœ¨

```
Table 'sync_rooms' already exists
```

**è¿™ä¸æ˜¯é”™è¯¯ï¼** ä½¿ç”¨äº† `IF NOT EXISTS`ï¼Œè¡¨å·²å­˜åœ¨ä¼šè‡ªåŠ¨è·³è¿‡ã€‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥

è¡¨åˆ›å»ºåï¼š

1. âœ… **åˆ·æ–° HeidiSQL** å·¦ä¾§è¡¨åˆ—è¡¨
2. âœ… **é‡å¯åç«¯æœåŠ¡**ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
3. âœ… **æµ‹è¯•åˆ›å»ºæˆ¿é—´åŠŸèƒ½**

---

**æ‰§è¡Œå®Œæˆåå‘Šè¯‰æˆ‘ç»“æœï¼** ğŸ‰
