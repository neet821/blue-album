<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO 连接测试</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.IO 连接测试</h1>
    <div id="status">正在连接...</div>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(msg, type = 'info') {
            const p = document.createElement('p');
            p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            p.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            log.appendChild(p);
        }
        
        addLog('开始连接到 http://127.0.0.1:8000 ...');
        
        const socket = io('http://127.0.0.1:8000', {
            path: '/ws/socket.io',
            transports: ['websocket', 'polling']
        });
        
        socket.on('connect', () => {
            status.textContent = '✅ 已连接';
            status.style.color = 'green';
            addLog(`成功连接! Socket ID: ${socket.id}`, 'success');
        });
        
        socket.on('connect_error', (error) => {
            status.textContent = '❌ 连接失败';
            status.style.color = 'red';
            addLog(`连接错误: ${error.message}`, 'error');
        });
        
        socket.on('disconnect', () => {
            status.textContent = '⚠️ 已断开';
            status.style.color = 'orange';
            addLog('连接已断开', 'error');
        });
    </script>
</body>
</html>
