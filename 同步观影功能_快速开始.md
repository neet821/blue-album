# å¤šäººåŒæ­¥è§‚å½±åŠŸèƒ½ - å¿«é€Ÿå¼€å§‹

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### Phase 1 (å·²å®Œæˆ)
- âœ… **æ¨¡å¼ä¸€**: å¤–éƒ¨é“¾æ¥æ’­æ”¾
- âœ… **åŒæ§åˆ¶æ¨¡å¼**: 
  - æˆ¿ä¸»ç‹¬äº«æ§åˆ¶
  - å…¨å‘˜å…±åŒæ§åˆ¶
- âœ… **å®æ—¶åŒæ­¥**: æ’­æ”¾/æš‚åœ/è·³è½¬åŒæ­¥
- âœ… **æ–‡å­—èŠå¤©**: æˆ¿é—´å†…å®æ—¶èŠå¤©
- âœ… **æˆå‘˜ç®¡ç†**: åŠ å…¥/ç¦»å¼€/æˆå‘˜åˆ—è¡¨
- âœ… **æˆ¿é—´ç®¡ç†**: åˆ›å»º/åŠ å…¥/å…³é—­æˆ¿é—´

### Phase 2 (å¾…å¼€å‘)
- â³ **æ¨¡å¼äºŒ-1**: æˆ¿ä¸»ä¸Šä¼ è§†é¢‘åˆ°æœåŠ¡å™¨
- â³ **æ¨¡å¼äºŒ-2**: ç”¨æˆ·æœ¬åœ°è§†é¢‘ + å“ˆå¸Œæ ¡éªŒ

## ğŸ“ æ–‡ä»¶ç»“æ„

```
blue-local/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ models.py              # æ–°å¢ 3 ä¸ªæ¨¡å‹
â”‚   â”œâ”€â”€ sync_room_crud.py      # æ–°å¢ æˆ¿é—´CRUDæ“ä½œ
â”‚   â”œâ”€â”€ websocket_server.py    # æ–°å¢ WebSocketæœåŠ¡å™¨
â”‚   â”œâ”€â”€ schemas.py             # æ–°å¢ Pydanticæ¨¡å‹
â”‚   â””â”€â”€ main.py                # æ–°å¢ APIè·¯ç”±
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ SyncRoomList.vue    # æ–°å¢ æˆ¿é—´åˆ—è¡¨é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ SyncRoomPlayer.vue  # æ–°å¢ æ’­æ”¾å™¨é¡µé¢
â”‚   â”‚   â””â”€â”€ router/
â”‚   â”‚       â””â”€â”€ index.js       # æ›´æ–° è·¯ç”±é…ç½®
â”‚   â””â”€â”€ package.json           # æ–°å¢ socket.io-client
â”‚
â””â”€â”€ åŒæ­¥è§‚å½±åŠŸèƒ½_éƒ¨ç½²æŒ‡å—.md    # å®Œæ•´éƒ¨ç½²æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå®‰è£…

### 1. å®‰è£…åç«¯ä¾èµ–

```bash
pip install python-socketio==5.10.0
```

### 2. å®‰è£…å‰ç«¯ä¾èµ–

```bash
cd frontend
npm install socket.io-client
```

### 3. åˆ›å»ºæ•°æ®åº“è¡¨

åœ¨ MySQL ä¸­æ‰§è¡Œ:

```sql
-- å¤åˆ¶"éƒ¨ç½²æŒ‡å—.md"ä¸­çš„ SQL è„šæœ¬
```

### 4. é‡å¯æœåŠ¡

```bash
# åç«¯
uvicorn main:app --reload

# å‰ç«¯
npm run dev
```

## ğŸ® ä½¿ç”¨æµç¨‹

### åˆ›å»ºæˆ¿é—´

1. è®¿é—®: `http://localhost:5173/tools/sync-room`
2. ç‚¹å‡» "åˆ›å»ºæˆ¿é—´"
3. å¡«å†™ä¿¡æ¯:
   ```
   æˆ¿é—´åç§°: å‘¨æœ«è§‚å½±
   æ’­æ”¾æ¨¡å¼: å¤–éƒ¨é“¾æ¥
   è§†é¢‘é“¾æ¥: https://www.w3schools.com/html/mov_bbb.mp4
   æ§åˆ¶æ¨¡å¼: ä»…æˆ¿ä¸»æ§åˆ¶ / æ‰€æœ‰æˆå‘˜æ§åˆ¶
   ```
4. åˆ›å»ºæˆåŠŸ,è‡ªåŠ¨è¿›å…¥æˆ¿é—´

### åŠ å…¥æˆ¿é—´

1. è·å–æˆ¿é—´ä»£ç (6ä½)
2. ç‚¹å‡» "åŠ å…¥æˆ¿é—´"
3. è¾“å…¥ä»£ç åŠ å…¥

### è§‚çœ‹è§†é¢‘

- **æˆ¿ä¸»æ§åˆ¶æ¨¡å¼**: åªæœ‰æˆ¿ä¸»èƒ½æ“ä½œæ’­æ”¾å™¨
- **å…¨å‘˜æ§åˆ¶æ¨¡å¼**: æ‰€æœ‰æˆå‘˜éƒ½èƒ½æ§åˆ¶
- **è‡ªåŠ¨åŒæ­¥**: è¿›åº¦è‡ªåŠ¨åŒæ­¥ç»™æ‰€æœ‰æˆå‘˜
- **å®æ—¶èŠå¤©**: å³ä¾§èŠå¤©åŒºåŸŸäº¤æµ

## ğŸ” æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         WebSocket         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯Vue 3   â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚   FastAPI    â”‚
â”‚             â”‚                          â”‚   Backend    â”‚
â”‚ - VideoJS   â”‚         HTTP API         â”‚              â”‚
â”‚ - Socket.IO â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ - SocketIO   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ - SQLAlchemy â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â†“
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚    MySQL    â”‚
                                         â”‚  Database   â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ API ç«¯ç‚¹

### REST API

```
POST   /api/sync-rooms              # åˆ›å»ºæˆ¿é—´
GET    /api/sync-rooms              # è·å–æˆ‘çš„æˆ¿é—´åˆ—è¡¨
GET    /api/sync-rooms/:id          # è·å–æˆ¿é—´è¯¦æƒ…
GET    /api/sync-rooms/code/:code   # é€šè¿‡ä»£ç è·å–æˆ¿é—´
POST   /api/sync-rooms/:id/join     # åŠ å…¥æˆ¿é—´
POST   /api/sync-rooms/code/:code/join  # é€šè¿‡ä»£ç åŠ å…¥
POST   /api/sync-rooms/:id/leave    # ç¦»å¼€æˆ¿é—´
DELETE /api/sync-rooms/:id          # å…³é—­æˆ¿é—´(æˆ¿ä¸»)
PUT    /api/sync-rooms/:id          # æ›´æ–°æˆ¿é—´(æˆ¿ä¸»)
GET    /api/sync-rooms/:id/members  # è·å–æˆå‘˜åˆ—è¡¨
GET    /api/sync-rooms/:id/messages # è·å–èŠå¤©è®°å½•
```

### WebSocket äº‹ä»¶

```javascript
// å®¢æˆ·ç«¯å‘é€
emit('join_room', { room_id, user_id, username })
emit('leave_room_event', { room_id, user_id })
emit('playback_control', { room_id, user_id, action, time })
emit('send_message', { room_id, user_id, username, message })
emit('time_update', { room_id, user_id, time })

// æœåŠ¡å™¨æ¨é€
on('join_success', { room, members })
on('member_joined', { user_id, username })
on('member_left', { user_id })
on('playback_sync', { action, time, rate })
on('time_sync', { time })
on('new_message', { id, user_id, username, message, created_at })
on('error', { message })
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•1: åˆ›å»ºæˆ¿é—´
- [x] å¡«å†™æˆ¿é—´ä¿¡æ¯
- [x] é€‰æ‹©æ§åˆ¶æ¨¡å¼
- [x] è¾“å…¥è§†é¢‘é“¾æ¥
- [x] åˆ›å»ºæˆåŠŸå¹¶è·³è½¬

### æµ‹è¯•2: åŠ å…¥æˆ¿é—´
- [x] è¾“å…¥æˆ¿é—´ä»£ç 
- [x] éªŒè¯æˆ¿é—´å­˜åœ¨
- [x] åŠ å…¥æˆåŠŸå¹¶åŒæ­¥çŠ¶æ€

### æµ‹è¯•3: æ’­æ”¾åŒæ­¥
- [x] æˆ¿ä¸»æ’­æ”¾ â†’ æˆå‘˜è‡ªåŠ¨æ’­æ”¾
- [x] æˆ¿ä¸»æš‚åœ â†’ æˆå‘˜è‡ªåŠ¨æš‚åœ
- [x] æˆ¿ä¸»è·³è½¬ â†’ æˆå‘˜è‡ªåŠ¨è·³è½¬
- [x] æ—¶é—´è¯¯å·®è¶…2ç§’è‡ªåŠ¨ä¿®æ­£

### æµ‹è¯•4: èŠå¤©åŠŸèƒ½
- [x] å‘é€æ¶ˆæ¯
- [x] å®æ—¶æ¥æ”¶
- [x] æ¶ˆæ¯å†å²åŠ è½½

### æµ‹è¯•5: æƒé™æ§åˆ¶
- [x] ä»…æˆ¿ä¸»æ§åˆ¶:æˆå‘˜æ— æ³•æ“ä½œ
- [x] å…¨å‘˜æ§åˆ¶:æ‰€æœ‰äººéƒ½èƒ½æ“ä½œ

## ğŸ“Š æ•°æ®åº“è¡¨è®¾è®¡

```sql
sync_rooms (æˆ¿é—´è¡¨)
â”œâ”€â”€ id
â”œâ”€â”€ room_code         # 6ä½ä»£ç 
â”œâ”€â”€ room_name
â”œâ”€â”€ host_user_id      # æˆ¿ä¸»ID
â”œâ”€â”€ control_mode      # host_only / all_members
â”œâ”€â”€ mode              # link / upload / local
â”œâ”€â”€ video_source      # è§†é¢‘é“¾æ¥
â”œâ”€â”€ current_time      # æ’­æ”¾æ—¶é—´
â”œâ”€â”€ is_playing        # æ’­æ”¾çŠ¶æ€
â””â”€â”€ is_active         # æˆ¿é—´æ´»è·ƒ

sync_room_members (æˆå‘˜è¡¨)
â”œâ”€â”€ id
â”œâ”€â”€ room_id
â”œâ”€â”€ user_id
â”œâ”€â”€ nickname
â”œâ”€â”€ is_verified       # å“ˆå¸Œæ ¡éªŒ(æ¨¡å¼äºŒ)
â””â”€â”€ joined_at

sync_room_messages (æ¶ˆæ¯è¡¨)
â”œâ”€â”€ id
â”œâ”€â”€ room_id
â”œâ”€â”€ user_id
â”œâ”€â”€ message
â””â”€â”€ created_at
```

## ğŸ› è°ƒè¯•æŠ€å·§

### åç«¯æ—¥å¿—
```python
# websocket_server.py å·²é…ç½®æ—¥å¿—
logger.info(f"User {user_id} joined room {room_id}")
```

### å‰ç«¯æ§åˆ¶å°
```javascript
// æ£€æŸ¥ WebSocket è¿æ¥çŠ¶æ€
console.log('Socket connected:', socket.value?.connected);

// ç›‘å¬æ‰€æœ‰äº‹ä»¶
socket.value?.onAny((event, ...args) => {
  console.log('WebSocket event:', event, args);
});
```

### ç½‘ç»œæ£€æŸ¥
```bash
# æµ‹è¯• WebSocket ç«¯ç‚¹
curl http://localhost:8000/ws/socket.io/?transport=polling

# åº”è¿”å› Socket.IO æ¡æ‰‹ä¿¡æ¯
```

## ğŸ’¡ å¸¸è§é—®é¢˜è§£å†³

### Q1: WebSocket è¿æ¥ä¸ä¸Š
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:8000/

# æ£€æŸ¥ WebSocket è·¯å¾„
curl http://localhost:8000/ws/socket.io/?transport=polling
```

### Q2: è§†é¢‘ä¸æ’­æ”¾
- ç¡®ä¿è§†é¢‘é“¾æ¥æ˜¯ç›´é“¾
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°CORSé”™è¯¯
- æµ‹è¯•é“¾æ¥: `https://www.w3schools.com/html/mov_bbb.mp4`

### Q3: åŒæ­¥å»¶è¿Ÿå¤§
- æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
- è°ƒæ•´ `time_update` é¢‘ç‡(é»˜è®¤2ç§’)
- è°ƒæ•´åŒæ­¥é˜ˆå€¼(é»˜è®¤2ç§’)

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **å¹¶å‘è¿æ¥**: æ”¯æŒ 100+ æˆ¿é—´åŒæ—¶åœ¨çº¿
- **åŒæ­¥å»¶è¿Ÿ**: < 500ms
- **æ¶ˆæ¯å»¶è¿Ÿ**: < 200ms
- **æ•°æ®åº“è´Ÿè½½**: ä½(å¤§éƒ¨åˆ†æ“ä½œåœ¨å†…å­˜)

## ğŸ”’ å®‰å…¨æªæ–½

- âœ… æˆ¿é—´æˆå‘˜éªŒè¯
- âœ… æ§åˆ¶æƒé™æ£€æŸ¥
- âœ… æ¶ˆæ¯é•¿åº¦é™åˆ¶
- âœ… SQLæ³¨å…¥é˜²æŠ¤
- âœ… XSSé˜²æŠ¤(å‰ç«¯)

## ğŸ“ TODO List

- [ ] æ·»åŠ æˆ¿é—´å¯†ç 
- [ ] æˆå‘˜è¸¢å‡ºåŠŸèƒ½
- [ ] æ•æ„Ÿè¯è¿‡æ»¤
- [ ] æ¶ˆæ¯é¢‘ç‡é™åˆ¶
- [ ] æˆ¿é—´äººæ•°é™åˆ¶
- [ ] è§†é¢‘ä¸Šä¼ åŠŸèƒ½(æ¨¡å¼äºŒ)
- [ ] å“ˆå¸Œæ ¡éªŒ(æ¨¡å¼äºŒ)
- [ ] Redis ç¼“å­˜ä¼˜åŒ–
- [ ] æ–­çº¿é‡è¿ä¼˜åŒ–
- [ ] ç§»åŠ¨ç«¯é€‚é…

## ğŸ‰ å®Œæˆåº¦

**Phase 1**: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%

- âœ… æ•°æ®åº“è®¾è®¡
- âœ… åç«¯API
- âœ… WebSocketæœåŠ¡
- âœ… å‰ç«¯é¡µé¢
- âœ… å®æ—¶åŒæ­¥
- âœ… èŠå¤©åŠŸèƒ½
- âœ… åŒæ§åˆ¶æ¨¡å¼

å‡†å¤‡å¼€å§‹ä½¿ç”¨! ğŸš€
