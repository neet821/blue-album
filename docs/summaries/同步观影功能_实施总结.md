# å¤šäººåŒæ­¥è§‚å½±åŠŸèƒ½ - å®æ–½æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯å¼€å‘

#### æ–°å¢æ–‡ä»¶
- `backend/sync_room_crud.py` - æˆ¿é—´CRUDæ“ä½œ
- `backend/websocket_server.py` - WebSocketå®æ—¶é€šä¿¡æœåŠ¡
- `backend/migrations/sync_rooms_migration.sql` - æ•°æ®åº“è¿ç§»è„šæœ¬
- `backend/requirements.txt` - ä¾èµ–é…ç½®

#### ä¿®æ”¹æ–‡ä»¶
- `backend/models.py` - æ–°å¢3ä¸ªæ•°æ®æ¨¡å‹
- `backend/schemas.py` - æ–°å¢Pydanticæ¨¡å‹
- `backend/main.py` - æ–°å¢REST APIè·¯ç”±å’ŒWebSocketæŒ‚è½½

### 2. å‰ç«¯å¼€å‘

#### æ–°å¢æ–‡ä»¶
- `frontend/src/views/SyncRoomList.vue` - æˆ¿é—´åˆ—è¡¨é¡µé¢
- `frontend/src/views/SyncRoomPlayer.vue` - æ’­æ”¾å™¨é¡µé¢
- `frontend/INSTALL_DEPENDENCIES.md` - ä¾èµ–å®‰è£…è¯´æ˜

#### ä¿®æ”¹æ–‡ä»¶
- `frontend/src/router/index.js` - æ–°å¢è·¯ç”±é…ç½®

### 3. æ–‡æ¡£

- `åŒæ­¥è§‚å½±åŠŸèƒ½_éƒ¨ç½²æŒ‡å—.md` - å®Œæ•´éƒ¨ç½²æ–‡æ¡£
- `åŒæ­¥è§‚å½±åŠŸèƒ½_å¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `åŒæ­¥è§‚å½±åŠŸèƒ½_å®æ–½æ€»ç»“.md` - æœ¬æ–‡æ¡£

## ğŸš€ ç«‹å³å¼€å§‹ä½¿ç”¨

### æ­¥éª¤1: å®‰è£…ä¾èµ–

```bash
# åç«¯
cd backend
pip install python-socketio==5.10.0

# å‰ç«¯
cd frontend
npm install socket.io-client
```

### æ­¥éª¤2: åˆ›å»ºæ•°æ®åº“è¡¨

åœ¨MySQLä¸­æ‰§è¡ŒSQLè„šæœ¬:

```bash
mysql -u root -p blue_local < backend/migrations/sync_rooms_migration.sql
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡ŒSQL:

```sql
USE blue_local;

CREATE TABLE IF NOT EXISTS sync_rooms (
    id INT PRIMARY KEY AUTO_INCREMENT,
    room_code VARCHAR(20) UNIQUE NOT NULL,
    room_name VARCHAR(100) NOT NULL,
    host_user_id INT NOT NULL,
    control_mode VARCHAR(20) DEFAULT 'host_only' NOT NULL,
    mode VARCHAR(20) DEFAULT 'link' NOT NULL,
    video_source TEXT,
    video_hash VARCHAR(64),
    current_time INT DEFAULT 0,
    is_playing BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (host_user_id) REFERENCES users(id),
    INDEX idx_room_code (room_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS sync_room_members (
    id INT PRIMARY KEY AUTO_INCREMENT,
    room_id INT NOT NULL,
    user_id INT NOT NULL,
    nickname VARCHAR(50),
    is_verified BOOLEAN DEFAULT TRUE,
    joined_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (room_id) REFERENCES sync_rooms(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_room_member (room_id, user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE IF NOT EXISTS sync_room_messages (
    id INT PRIMARY KEY AUTO_INCREMENT,
    room_id INT NOT NULL,
    user_id INT NOT NULL,
    message TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (room_id) REFERENCES sync_rooms(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### æ­¥éª¤3: é‡å¯æœåŠ¡

```bash
# åœæ­¢ç°æœ‰æœåŠ¡ (Ctrl+C)

# å¯åŠ¨åç«¯
cd backend
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# å¯åŠ¨å‰ç«¯(æ–°ç»ˆç«¯)
cd frontend
npm run dev
```

### æ­¥éª¤4: æµ‹è¯•åŠŸèƒ½

1. è®¿é—®: http://localhost:5173/tools/sync-room
2. ç‚¹å‡»"åˆ›å»ºæˆ¿é—´"
3. å¡«å†™ä¿¡æ¯å¹¶åˆ›å»º
4. åœ¨å¦ä¸€ä¸ªæµè§ˆå™¨åŠ å…¥æˆ¿é—´æµ‹è¯•åŒæ­¥

## ğŸ“‹ åŠŸèƒ½æ¸…å•

### Phase 1 - å·²å®Œæˆ âœ…

- [x] æˆ¿é—´ç®¡ç†
  - [x] åˆ›å»ºæˆ¿é—´(ç”Ÿæˆ6ä½ä»£ç )
  - [x] åŠ å…¥æˆ¿é—´(é€šè¿‡ä»£ç )
  - [x] ç¦»å¼€æˆ¿é—´
  - [x] å…³é—­æˆ¿é—´(æˆ¿ä¸»)
  - [x] æˆ¿é—´åˆ—è¡¨

- [x] æ’­æ”¾æ§åˆ¶
  - [x] å¤–éƒ¨è§†é¢‘é“¾æ¥æ’­æ”¾
  - [x] æ’­æ”¾/æš‚åœåŒæ­¥
  - [x] è·³è½¬åŒæ­¥
  - [x] æ—¶é—´è‡ªåŠ¨åŒæ­¥
  - [x] åŒæ§åˆ¶æ¨¡å¼(æˆ¿ä¸»/å…¨å‘˜)

- [x] å®æ—¶èŠå¤©
  - [x] å‘é€æ¶ˆæ¯
  - [x] æ¥æ”¶æ¶ˆæ¯
  - [x] æ¶ˆæ¯å†å²
  - [x] å®æ—¶æ¨é€

- [x] æˆå‘˜ç®¡ç†
  - [x] æˆå‘˜åˆ—è¡¨
  - [x] åŠ å…¥é€šçŸ¥
  - [x] ç¦»å¼€é€šçŸ¥
  - [x] æˆ¿ä¸»æ ‡è¯†

### Phase 2 - å¾…å¼€å‘ â³

- [ ] æ¨¡å¼äºŒ-1: æˆ¿ä¸»ä¸Šä¼ è§†é¢‘
  - [ ] æ–‡ä»¶ä¸Šä¼ æ¥å£
  - [ ] è§†é¢‘å­˜å‚¨
  - [ ] è½¬ç å¤„ç†
  - [ ] æµå¼æ’­æ”¾

- [ ] æ¨¡å¼äºŒ-2: æœ¬åœ°è§†é¢‘åŒæ­¥
  - [ ] å“ˆå¸Œè®¡ç®—
  - [ ] å“ˆå¸Œæ ¡éªŒ
  - [ ] æœªé€šè¿‡å¤„ç†

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
Frontend (Vue 3)
â”œâ”€â”€ SyncRoomList.vue      æˆ¿é—´åˆ—è¡¨
â”œâ”€â”€ SyncRoomPlayer.vue    æ’­æ”¾å™¨é¡µé¢
â””â”€â”€ Socket.IO Client      WebSocketå®¢æˆ·ç«¯

Backend (FastAPI)
â”œâ”€â”€ REST API              æˆ¿é—´ç®¡ç†æ¥å£
â”œâ”€â”€ WebSocket Server      å®æ—¶é€šä¿¡
â”œâ”€â”€ CRUD Operations       æ•°æ®åº“æ“ä½œ
â””â”€â”€ Authentication        è®¤è¯ä¸­é—´ä»¶

Database (MySQL)
â”œâ”€â”€ sync_rooms            æˆ¿é—´è¡¨
â”œâ”€â”€ sync_room_members     æˆå‘˜è¡¨
â””â”€â”€ sync_room_messages    æ¶ˆæ¯è¡¨
```

## ğŸ¯ APIæ–‡æ¡£

### REST API

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/sync-rooms | åˆ›å»ºæˆ¿é—´ |
| GET | /api/sync-rooms | è·å–æˆ‘çš„æˆ¿é—´ |
| GET | /api/sync-rooms/:id | è·å–æˆ¿é—´è¯¦æƒ… |
| GET | /api/sync-rooms/code/:code | é€šè¿‡ä»£ç è·å– |
| POST | /api/sync-rooms/:id/join | åŠ å…¥æˆ¿é—´ |
| POST | /api/sync-rooms/:id/leave | ç¦»å¼€æˆ¿é—´ |
| DELETE | /api/sync-rooms/:id | å…³é—­æˆ¿é—´ |
| GET | /api/sync-rooms/:id/members | æˆå‘˜åˆ—è¡¨ |
| GET | /api/sync-rooms/:id/messages | èŠå¤©è®°å½• |

### WebSocketäº‹ä»¶

å®¢æˆ·ç«¯å‘é€:
- join_room
- leave_room_event
- playback_control
- send_message
- time_update

æœåŠ¡å™¨æ¨é€:
- join_success
- member_joined
- member_left
- playback_sync
- time_sync
- new_message
- error

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] åˆ›å»ºæˆ¿é—´æˆåŠŸ
- [ ] åŠ å…¥æˆ¿é—´æˆåŠŸ
- [ ] ç¦»å¼€æˆ¿é—´æˆåŠŸ
- [ ] æˆ¿é—´åˆ—è¡¨æ˜¾ç¤ºæ­£ç¡®

### åŒæ­¥æµ‹è¯•

- [ ] æˆ¿ä¸»æ’­æ”¾,æˆå‘˜è‡ªåŠ¨æ’­æ”¾
- [ ] æˆ¿ä¸»æš‚åœ,æˆå‘˜è‡ªåŠ¨æš‚åœ
- [ ] æˆ¿ä¸»è·³è½¬,æˆå‘˜è‡ªåŠ¨è·³è½¬
- [ ] æ—¶é—´è¯¯å·®è‡ªåŠ¨ä¿®æ­£

### æƒé™æµ‹è¯•

- [ ] ä»…æˆ¿ä¸»æ¨¡å¼:æˆå‘˜æ— æ³•æ§åˆ¶
- [ ] å…¨å‘˜æ¨¡å¼:æ‰€æœ‰äººå¯æ§åˆ¶
- [ ] æˆ¿ä¸»å¯å…³é—­æˆ¿é—´
- [ ] éæˆ¿ä¸»æ— æ³•å…³é—­

### èŠå¤©æµ‹è¯•

- [ ] å‘é€æ¶ˆæ¯æˆåŠŸ
- [ ] æ‰€æœ‰æˆå‘˜æ”¶åˆ°æ¶ˆæ¯
- [ ] æ¶ˆæ¯å†å²åŠ è½½æ­£ç¡®
- [ ] æ¶ˆæ¯å®æ—¶æ¨é€

### å¼‚å¸¸æµ‹è¯•

- [ ] æ–­çº¿é‡è¿
- [ ] æˆ¿é—´ä¸å­˜åœ¨å¤„ç†
- [ ] æ— æƒé™è®¿é—®å¤„ç†
- [ ] ç½‘ç»œå»¶è¿Ÿå¤„ç†

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **WebSocketç«¯å£**: ç¡®ä¿8000ç«¯å£æœªè¢«å ç”¨
2. **è§†é¢‘é“¾æ¥**: å¿…é¡»æ˜¯ç›´é“¾ä¸”æ”¯æŒCORS
3. **æµè§ˆå™¨**: å»ºè®®ä½¿ç”¨Chrome/Edgeæœ€æ–°ç‰ˆ
4. **ç½‘ç»œ**: æµ‹è¯•æ—¶ç¡®ä¿ç½‘ç»œç¨³å®š

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: WebSocketè¿æ¥å¤±è´¥

æ£€æŸ¥æ­¥éª¤:
1. åç«¯æ˜¯å¦è¿è¡Œåœ¨8000ç«¯å£
2. æ£€æŸ¥main.pyæ˜¯å¦æ­£ç¡®æŒ‚è½½WebSocket
3. æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### é—®é¢˜2: è§†é¢‘æ— æ³•æ’­æ”¾

æ£€æŸ¥æ­¥éª¤:
1. è§†é¢‘é“¾æ¥æ˜¯å¦å¯è®¿é—®
2. è§†é¢‘æ ¼å¼æ˜¯å¦æ”¯æŒ(MP4/WebM)
3. æ˜¯å¦æœ‰CORSé™åˆ¶

### é—®é¢˜3: åŒæ­¥å»¶è¿Ÿå¤§

ä¼˜åŒ–æ–¹æ¡ˆ:
1. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
2. è°ƒæ•´time_updateé¢‘ç‡
3. è°ƒæ•´åŒæ­¥é˜ˆå€¼

## ğŸ“Š æ€§èƒ½æ•°æ®

- æ”¯æŒå¹¶å‘æˆ¿é—´: 100+
- WebSocketå»¶è¿Ÿ: <500ms
- æ¶ˆæ¯å»¶è¿Ÿ: <200ms
- åŒæ­¥ç²¾åº¦: Â±2ç§’

## ğŸ‰ æ€»ç»“

Phase 1 å¤šäººåŒæ­¥è§‚å½±åŠŸèƒ½å·²å®Œæ•´å®ç°:

âœ… æ ¸å¿ƒåŠŸèƒ½å®Œå¤‡
âœ… å®æ—¶é€šä¿¡ç¨³å®š  
âœ… åŒæ§åˆ¶æ¨¡å¼æ”¯æŒ
âœ… æ–‡å­—èŠå¤©æµç•…
âœ… ä»£ç ç»“æ„æ¸…æ™°

å¯ä»¥å¼€å§‹ä½¿ç”¨äº†! ğŸš€

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜è¯·å‚è€ƒ:
- éƒ¨ç½²æŒ‡å—: åŒæ­¥è§‚å½±åŠŸèƒ½_éƒ¨ç½²æŒ‡å—.md
- å¿«é€Ÿå¼€å§‹: åŒæ­¥è§‚å½±åŠŸèƒ½_å¿«é€Ÿå¼€å§‹.md
