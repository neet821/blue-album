# Blue Album æœåŠ¡å™¨éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éœ€è¦æ£€æŸ¥å’Œæä¾›çš„ä¿¡æ¯

### 1. æœåŠ¡å™¨åŸºæœ¬ä¿¡æ¯
```bash
# 1.1 ç³»ç»Ÿä¿¡æ¯
uname -a
cat /etc/os-release

# 1.2 å·²å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬
nginx -v
python3 --version
mysql --version
docker --version  # å¦‚æœä½¿ç”¨ Docker
```

### 2. é¡¹ç›®ç›®å½•ç»“æ„
```bash
# 2.1 æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•
ls -la /home/wwwroot/blue-album.top/

# 2.2 æŸ¥çœ‹å‰ç«¯ç›®å½•
ls -la /home/wwwroot/blue-album.top/frontend/
ls -la /home/wwwroot/blue-album.top/frontend/dist/

# 2.3 æŸ¥çœ‹åç«¯ç›®å½•
ls -la /home/wwwroot/blue-album.top/backend/

# 2.4 æŸ¥çœ‹é…ç½®æ–‡ä»¶
ls -la /home/wwwroot/blue-album.top/.env
cat /home/wwwroot/blue-album.top/.env  # æ£€æŸ¥ç¯å¢ƒå˜é‡
```

### 3. æœåŠ¡è¿è¡ŒçŠ¶æ€
```bash
# 3.1 æ£€æŸ¥åç«¯è¿›ç¨‹
ps aux | grep uvicorn
ps aux | grep python

# 3.2 æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 8000  # åç«¯ç«¯å£
netstat -tulpn | grep 3306  # MySQL ç«¯å£
netstat -tulpn | grep 80    # HTTP ç«¯å£
netstat -tulpn | grep 443   # HTTPS ç«¯å£

# 3.3 å¦‚æœä½¿ç”¨ Docker
docker ps
docker-compose ps
```

### 4. æ•°æ®åº“çŠ¶æ€
```bash
# 4.1 æ£€æŸ¥ MySQL æœåŠ¡
systemctl status mysql

# 4.2 æ£€æŸ¥æ•°æ®åº“
mysql -u root -p
# ç„¶åæ‰§è¡Œï¼š
SHOW DATABASES;
USE blue_local_db;  # æˆ– blue_album
SHOW TABLES;
EXIT;
```

### 5. Nginx é…ç½®
```bash
# 5.1 æ£€æŸ¥ Nginx é…ç½®è¯­æ³•
nginx -t

# 5.2 æŸ¥çœ‹å½“å‰é…ç½®
cat /usr/local/nginx/conf/vhost/blue-album.top.conf

# 5.3 æŸ¥çœ‹ Nginx çŠ¶æ€
systemctl status nginx
# æˆ–
ps aux | grep nginx
```

### 6. æ—¥å¿—æ–‡ä»¶
```bash
# 6.1 Nginx æ—¥å¿—
tail -f /home/wwwlogs/blue-album.top.log
tail -f /home/wwwlogs/blue-album.top-error.log

# 6.2 åç«¯æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰
tail -f /home/wwwroot/blue-album.top/logs/backend.log

# 6.3 ç³»ç»Ÿæ—¥å¿—
journalctl -u nginx -f
journalctl -u blue-album-backend -f  # å¦‚æœä½¿ç”¨ systemd
```

### 7. æƒé™æ£€æŸ¥
```bash
# 7.1 æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰è€…
ls -la /home/wwwroot/blue-album.top/

# 7.2 æ£€æŸ¥ Nginx è¿è¡Œç”¨æˆ·
ps aux | grep nginx | grep -v grep

# 7.3 ç¡®ä¿æƒé™æ­£ç¡®
# Nginx ç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯ www æˆ– nginxï¼‰éœ€è¦è¯»å–æƒé™
chown -R www:www /home/wwwroot/blue-album.top/
# æˆ–
chown -R nginx:nginx /home/wwwroot/blue-album.top/
```

### 8. é˜²ç«å¢™å’Œå®‰å…¨ç»„
```bash
# 8.1 æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
iptables -L -n
# æˆ–
firewall-cmd --list-all

# 8.2 ç¡®ä¿ç«¯å£å¼€æ”¾
# HTTP (80), HTTPS (443) å¿…é¡»å¼€æ”¾
# å¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨ï¼Œè¿˜éœ€è¦åœ¨æ§åˆ¶å°é…ç½®å®‰å…¨ç»„
```

---

## ğŸ”§ å¿«é€Ÿè¯Šæ–­å‘½ä»¤ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º `check-server.sh`ï¼Œç„¶åæ‰§è¡Œï¼š

```bash
#!/bin/bash
echo "================================"
echo "Blue Album æœåŠ¡å™¨è¯Šæ–­æŠ¥å‘Š"
echo "================================"
echo ""

echo "=== 1. ç³»ç»Ÿä¿¡æ¯ ==="
uname -a
echo ""

echo "=== 2. è½¯ä»¶ç‰ˆæœ¬ ==="
echo -n "Nginx: "; nginx -v 2>&1 | awk '{print $3}'
echo -n "Python: "; python3 --version
echo -n "MySQL: "; mysql --version | awk '{print $5}' | cut -d',' -f1
echo ""

echo "=== 3. é¡¹ç›®ç›®å½• ==="
ls -lh /home/wwwroot/blue-album.top/ | grep -E "^d|^-"
echo ""

echo "=== 4. å‰ç«¯æ„å»ºæ–‡ä»¶ ==="
if [ -d "/home/wwwroot/blue-album.top/frontend/dist" ]; then
    echo "âœ… å‰ç«¯ dist ç›®å½•å­˜åœ¨"
    ls -lh /home/wwwroot/blue-album.top/frontend/dist/ | head -5
else
    echo "âŒ å‰ç«¯ dist ç›®å½•ä¸å­˜åœ¨ï¼éœ€è¦æ„å»ºå‰ç«¯"
fi
echo ""

echo "=== 5. ç¯å¢ƒå˜é‡ ==="
if [ -f "/home/wwwroot/blue-album.top/.env" ]; then
    echo "âœ… .env æ–‡ä»¶å­˜åœ¨"
    echo "é…ç½®é¡¹ï¼š"
    cat /home/wwwroot/blue-album.top/.env | grep -v "^#" | grep -v "^$" | cut -d'=' -f1
else
    echo "âŒ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼"
fi
echo ""

echo "=== 6. æœåŠ¡è¿è¡ŒçŠ¶æ€ ==="
echo -n "åç«¯è¿›ç¨‹: "
if ps aux | grep -v grep | grep uvicorn > /dev/null; then
    echo "âœ… è¿è¡Œä¸­"
    ps aux | grep -v grep | grep uvicorn | awk '{print "  PID:"$2, "CPU:"$3"%", "MEM:"$4"%"}'
else
    echo "âŒ æœªè¿è¡Œ"
fi

echo -n "MySQL: "
if systemctl is-active mysql > /dev/null 2>&1; then
    echo "âœ… è¿è¡Œä¸­"
else
    echo "âŒ æœªè¿è¡Œ"
fi

echo -n "Nginx: "
if systemctl is-active nginx > /dev/null 2>&1; then
    echo "âœ… è¿è¡Œä¸­"
else
    echo "âŒ æœªè¿è¡Œ"
fi
echo ""

echo "=== 7. ç«¯å£ç›‘å¬ ==="
netstat -tulpn | grep -E ":(80|443|3306|8000)\s"
echo ""

echo "=== 8. æ•°æ®åº“ ==="
echo "SHOW DATABASES LIKE 'blue_%';" | mysql -u root 2>/dev/null || echo "âš ï¸  éœ€è¦ MySQL å¯†ç "
echo ""

echo "=== 9. Nginx é…ç½®æ£€æŸ¥ ==="
nginx -t 2>&1
echo ""

echo "=== 10. æœ€è¿‘é”™è¯¯æ—¥å¿—ï¼ˆæœ€å10è¡Œï¼‰==="
if [ -f "/home/wwwlogs/blue-album.top-error.log" ]; then
    tail -10 /home/wwwlogs/blue-album.top-error.log
else
    echo "æ— é”™è¯¯æ—¥å¿—"
fi
echo ""

echo "================================"
echo "è¯Šæ–­å®Œæˆï¼"
echo "================================"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp check-server.sh root@your-server-ip:/root/

# SSH ç™»å½•æœåŠ¡å™¨
ssh root@your-server-ip

# æ‰§è¡Œæ£€æŸ¥
chmod +x check-server.sh
./check-server.sh
```

---

## ğŸ“¤ è¯·æä¾›ä»¥ä¸‹è¾“å‡º

**æ–¹å¼ä¸€ï¼šè¿è¡Œè¯Šæ–­è„šæœ¬**
```bash
bash check-server.sh > server-status.txt 2>&1
cat server-status.txt
```

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ‰§è¡Œå…³é”®å‘½ä»¤**
è‡³å°‘éœ€è¦è¿™äº›ï¼š
```bash
# 1. é¡¹ç›®ç›®å½•ç»“æ„
ls -la /home/wwwroot/blue-album.top/

# 2. å‰ç«¯æ˜¯å¦æ„å»º
ls /home/wwwroot/blue-album.top/frontend/dist/

# 3. åç«¯è¿è¡ŒçŠ¶æ€
ps aux | grep uvicorn

# 4. ç«¯å£å ç”¨
netstat -tulpn | grep 8000

# 5. .env é…ç½®ï¼ˆéšè—å¯†ç ï¼‰
cat /home/wwwroot/blue-album.top/.env | grep -v PASSWORD | grep -v SECRET
```

---

æŠŠä¸Šé¢å‘½ä»¤çš„è¾“å‡ºå‘ç»™æˆ‘ï¼Œæˆ‘å°±èƒ½ç»™ä½ å®Œæ•´çš„éƒ¨ç½²æ–¹æ¡ˆäº†ï¼ ğŸš€
