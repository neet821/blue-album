# 数据库名称修正说明

**修改日期**: 2025年10月24日

## 🔧 修改内容

### 背景说明
- **本地数据库名**: `blue_local_db` （当前开发环境使用）
- **线上数据库名**: `blue_album` （待上线部署的网站名字）

### 修改的文件

#### 1. `backend/config.py`
```python
# 修改前
DB_NAME = os.getenv("DB_NAME", "blue_album")

# 修改后
DB_NAME = os.getenv("DB_NAME", "blue_local_db")
```

#### 2. `.env.example`
```bash
# 修改前
DB_NAME=blue_album

# 修改后
DB_NAME=blue_local_db
```

#### 3. `docs/deployment/环境适配完全指南.md`
更新了文档中所有对 `blue_album` 的引用为 `blue_local_db`：
- 环境配置示例（开发环境和生产环境）
- 数据库创建命令
- 故障排查命令

## ✅ 验证结果

### 后端服务状态
- ✅ 后端已检测到配置变化并自动重新加载
- ✅ 服务运行在 http://127.0.0.1:8000
- ✅ 进程 ID: 13548 (自动重载后的新进程)

### 配置生效
```
INFO: StatReload detected changes in 'backend\config.py'. Reloading...
INFO: Application startup complete.
```

## 📋 后续操作建议

### 1. 确认数据库存在
在 Laragon 的 HeidiSQL 或 MySQL 命令行中确认：
```sql
SHOW DATABASES LIKE 'blue_local_db';
```

如果不存在，创建数据库：
```sql
CREATE DATABASE blue_local_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 运行数据库迁移
```bash
# 如果有 Alembic 迁移文件
alembic upgrade head

# 或者运行初始化脚本（如果有）
python backend/init_db.py
```

### 3. 测试 API 连接
```bash
# 测试健康检查
curl http://127.0.0.1:8000/api/health

# 测试获取文章
curl http://127.0.0.1:8000/api/articles

# 测试登录
curl -X POST http://127.0.0.1:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"yourpassword"}'
```

## 🚀 部署时注意事项

### 线上环境配置
当部署到生产服务器时，如果要使用 `blue_album` 作为数据库名：

1. **方式1**: 在服务器的 `.env` 文件中覆盖
```bash
# 服务器上的 .env
DB_NAME=blue_album
```

2. **方式2**: 修改 `backend/config.py` 的默认值
```python
# 根据环境类型使用不同的数据库名
if ENV == "development":
    DB_NAME = os.getenv("DB_NAME", "blue_local_db")
else:  # production or docker
    DB_NAME = os.getenv("DB_NAME", "blue_album")
```

## 📝 相关文件清单

- ✅ `backend/config.py` - 核心配置文件
- ✅ `.env.example` - 环境变量模板
- ✅ `docs/deployment/环境适配完全指南.md` - 部署文档
- ⏳ `.env` - 需要手动创建并配置（从 .env.example 复制）

## 🔍 问题排查

如果遇到 "Unknown database 'blue_local_db'" 错误：
1. 检查 MySQL 服务是否运行
2. 确认数据库是否已创建
3. 检查 `.env` 文件配置是否正确
4. 重启后端服务
