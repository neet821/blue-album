# 注册 500 错误解决方案

## 问题诊断

您遇到的 500 Internal Server Error 通常由以下原因引起:

### 1. MySQL 服务未运行

**检查方法:**
1. 打开 Laragon 控制面板
2. 检查 MySQL 是否显示为 "Running"
3. 如果没有运行,点击 "Start All" 或单独启动 MySQL

**手动启动:**
```powershell
# 使用 Laragon 菜单启动 MySQL
# 或者在命令行中:
cd D:\Laragon\bin\mysql\mysql-8.0.30-winx64\bin
.\mysqld.exe --console
```

### 2. 数据库或表未创建

**解决方法:**

打开命令提示符或 PowerShell,执行:

```powershell
# 方法 1: 使用 Python 脚本
cd d:\Laragon\laragon\www\blue-local
python -c "import pymysql; conn = pymysql.connect(host='localhost', user='root', password=''); cursor = conn.cursor(); cursor.execute('CREATE DATABASE IF NOT EXISTS blue_local_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci'); conn.commit(); print('数据库创建成功'); cursor.close(); conn.close()"

# 方法 2: 创建表
python -c "import sys; sys.path.insert(0, '.'); from backend.database import engine; from backend.models import Base; Base.metadata.create_all(bind=engine); print('表创建成功')"
```

或者使用 HeidiSQL (Laragon 自带):
1. 右键 Laragon 托盘图标 > MySQL > HeidiSQL
2. 连接到 MySQL (root, 无密码)
3. 右键左侧 > 创建新的 > 数据库
4. 名称: `blue_local_db`
5. 字符集: `utf8mb4`, 排序规则: `utf8mb4_unicode_ci`

### 3. 数据库连接配置错误

检查 `backend/database.py`:
```python
SQLALCHEMY_DATABASE_URL = "mysql+pymysql://root:@localhost/blue_local_db"
```

确保:
- MySQL 运行在 localhost:3306
- 用户名是 root
- 密码为空
- 数据库名为 blue_local_db

### 4. 缺少 Python 依赖

确保安装了所有必需的包:
```powershell
cd d:\Laragon\laragon\www\blue-local\backend
pip install fastapi uvicorn sqlalchemy pymysql passlib[bcrypt] python-jose[cryptography] python-multipart pydantic[email]
```

## 快速修复步骤

按顺序执行以下步骤:

### 步骤 1: 确保 MySQL 运行
打开 Laragon,点击 "Start All"

### 步骤 2: 创建数据库
在项目根目录执行:
```powershell
cd d:\Laragon\laragon\www\blue-local

# 创建数据库
python -c "import pymysql; conn = pymysql.connect(host='localhost', user='root', password=''); cursor = conn.cursor(); cursor.execute('CREATE DATABASE IF NOT EXISTS blue_local_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci'); conn.commit(); cursor.close(); conn.close()"
```

### 步骤 3: 创建表
```powershell
python -c "import sys; sys.path.insert(0, '.'); from backend.database import engine; from backend.models import Base; Base.metadata.create_all(bind=engine)"
```

### 步骤 4: 重启后端
停止现有后端 (Ctrl+C),然后重启:
```powershell
python -m uvicorn backend.main:app --reload --port 8000
```

### 步骤 5: 测试注册
刷新浏览器,再次尝试注册

## 查看后端详细错误

启动后端时,它会在终端显示详细的错误信息。请在后端终端查找:

```
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  ...
```

将这些错误信息告诉我,我可以提供针对性的解决方案。

## 如果问题仍然存在

请提供以下信息:

1. **Laragon MySQL 状态**: 是否显示为 Running?
2. **后端终端完整错误**: 复制粘贴后端终端显示的完整错误堆栈
3. **数据库列表**: 在 HeidiSQL 中可以看到哪些数据库?
4. **Python 版本**: 运行 `python --version` 的结果

有了这些信息,我可以快速定位并解决问题!
