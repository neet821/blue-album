# ç¯å¢ƒé€‚é…å®Œå…¨æŒ‡å—

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šæœ¬åœ° vs æœåŠ¡å™¨ç¯å¢ƒå·®å¼‚

### å·®å¼‚å¯¹æ¯”è¡¨

| é¡¹ç›® | æœ¬åœ° Windows | æœåŠ¡å™¨ Linux | è§£å†³æ–¹æ¡ˆ |
|------|-------------|-------------|---------|
| **è·¯å¾„åˆ†éš”ç¬¦** | `\` (åæ–œæ ) | `/` (æ­£æ–œæ ) | âœ… ä½¿ç”¨ `Path()` è‡ªåŠ¨å¤„ç† |
| **é¡¹ç›®æ ¹ç›®å½•** | `d:\Laragon\...` | `/var/www/...` | âœ… è‡ªåŠ¨æ£€æµ‹ `__file__` |
| **Python è·¯å¾„** | `C:\Python\...` | `/usr/bin/python3` | âœ… è™šæ‹Ÿç¯å¢ƒç»Ÿä¸€ |
| **æ•°æ®åº“ä¸»æœº** | `localhost` | `127.0.0.1` æˆ–å®¹å™¨å | âœ… ç¯å¢ƒå˜é‡é…ç½® |
| **æœåŠ¡å™¨åœ°å€** | `127.0.0.1` | `0.0.0.0` | âœ… æ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹© |
| **ç«¯å£å ç”¨** | å¯èƒ½å†²çª | å¯èƒ½å†²çª | âœ… æ£€æµ‹å¹¶æç¤º |
| **æ–‡ä»¶æƒé™** | è‡ªåŠ¨ | éœ€è¦è®¾ç½® | âœ… éƒ¨ç½²è„šæœ¬è‡ªåŠ¨å¤„ç† |

---

## âœ… å·²å®ç°çš„è‡ªé€‚åº”æœºåˆ¶

### 1. **ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹** (`backend/config.py`)

```python
# è‡ªåŠ¨è¯†åˆ«è¿è¡Œç¯å¢ƒ
- Windows + Laragon â†’ development
- Linux ç”Ÿäº§æœåŠ¡å™¨ â†’ production  
- Docker å®¹å™¨ â†’ docker

# æ ¹æ®ç¯å¢ƒè‡ªåŠ¨è°ƒæ•´ï¼š
- æ•°æ®åº“è¿æ¥
- æœåŠ¡å™¨ç›‘å¬åœ°å€
- CORS ç™½åå•
- æ—¥å¿—çº§åˆ«
```

### 2. **è·¨å¹³å°è·¯å¾„å¤„ç†**

```python
# âŒ é”™è¯¯å†™æ³•ï¼ˆWindows ä¸“ç”¨ï¼‰
path = "d:\\uploads\\file.jpg"

# âœ… æ­£ç¡®å†™æ³•ï¼ˆè·¨å¹³å°ï¼‰
from pathlib import Path
path = Path(__file__).parent / "uploads" / "file.jpg"
# Windows: d:\project\uploads\file.jpg
# Linux: /var/www/project/uploads/file.jpg
```

### 3. **ç¯å¢ƒå˜é‡é…ç½®**

```bash
# æœ¬åœ° .env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=
CORS_ORIGINS=http://localhost:5173

# æœåŠ¡å™¨ .env
DB_HOST=127.0.0.1
DB_USER=blue_user
DB_PASSWORD=StrongPassword123!
CORS_ORIGINS=https://yourdomain.com
```

---

## ğŸš€ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### æ­¥éª¤1ï¼šéªŒè¯æœ¬åœ°ç¯å¢ƒ

```powershell
# åœ¨æœ¬åœ°è¿è¡Œç¯å¢ƒæ£€æµ‹
cd d:\Laragon\laragon\www\blue-local
python scripts\deployment\validate-environment.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ“ Python 3.11+
âœ“ Node.js 18+
âœ“ MySQL running
âœ“ All dependencies installed
âœ“ Project structure correct
âœ“ .env file configured
```

### æ­¥éª¤2ï¼šæµ‹è¯•é…ç½®è‡ªé€‚åº”

```powershell
# æµ‹è¯•é…ç½®æ£€æµ‹
python backend\config.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
============================================================
ğŸ–¥ï¸  Environment: development
ğŸ”§ Platform: Windows 10
ğŸ“ Project Root: d:\Laragon\laragon\www\blue-local
ğŸ—„ï¸  Database: localhost:3306/blue_album
ğŸŒ Server: 127.0.0.1:8000
ğŸ” CORS Origins: ['http://localhost:5173', ...]
ğŸ“ Log Level: DEBUG
============================================================
```

### æ­¥éª¤3ï¼šæ‰“åŒ…éƒ¨ç½²æ–‡ä»¶

```powershell
# æ”¶é›†æ‰€æœ‰éƒ¨ç½²æ–‡ä»¶
.\scripts\deployment\collect-deployment-files.ps1

# å‹ç¼©æ‰“åŒ…
Compress-Archive -Path deployment-package -DestinationPath blue-local-deploy.zip
```

### æ­¥éª¤4ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

```powershell
# ä¸Šä¼ éƒ¨ç½²åŒ…
scp blue-local-deploy.zip user@server:/tmp/

# æˆ–ä½¿ç”¨ Git åŒæ­¥
.\scripts\sync\push-shared-branch.ps1
```

### æ­¥éª¤5ï¼šæœåŠ¡å™¨ç«¯éªŒè¯

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh user@server

# è§£å‹ï¼ˆå¦‚æœç”¨ SCPï¼‰
cd /var/www
unzip /tmp/blue-local-deploy.zip
mv deployment-package blue-local
cd blue-local

# æˆ–æ‹‰å– Gitï¼ˆå¦‚æœç”¨åŒæ­¥åˆ†æ”¯ï¼‰
git clone https://github.com/neet821/blue-album.git blue-local
cd blue-local
git checkout shared/win-sync
git pull

# è¿è¡Œç¯å¢ƒæ£€æµ‹
python3 scripts/deployment/validate-environment.py
```

**é¢„æœŸæœåŠ¡å™¨è¾“å‡ºï¼š**
```
============================================================
ğŸ–¥ï¸  Environment: production
ğŸ”§ Platform: Linux 5.x
ğŸ“ Project Root: /var/www/blue-local
ğŸ—„ï¸  Database: 127.0.0.1:3306/blue_album
ğŸŒ Server: 0.0.0.0:8000
ğŸ” CORS Origins: ['https://yourdomain.com', ...]
ğŸ“ Log Level: INFO
============================================================
```

---

## ğŸ› ï¸ éœ€è¦æ‰‹åŠ¨é…ç½®çš„é¡¹ç›®

### 1. **æœåŠ¡å™¨ .env æ–‡ä»¶**

```bash
# å¤åˆ¶æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®ï¼ˆé‡è¦ï¼ï¼‰
nano .env
```

**å¿…é¡»ä¿®æ”¹çš„å˜é‡ï¼š**
```bash
# æ•°æ®åº“å¯†ç ï¼ˆä¸è¦ç”¨ç©ºå¯†ç ï¼ï¼‰
DB_PASSWORD=ä½ çš„å¼ºå¯†ç 

# JWT å¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰
SECRET_KEY=ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²_è‡³å°‘32å­—ç¬¦

# å…è®¸çš„å‰ç«¯åŸŸå
CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# å¦‚æœä½¿ç”¨ Docker
DOCKER_ENV=true
DB_HOST=mysql  # Docker æœåŠ¡å
```

### 2. **æ•°æ®åº“åˆ›å»º**

```bash
# ç™»å½• MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE blue_album CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'blue_user'@'localhost' IDENTIFIED BY 'ä½ çš„å¯†ç ';
GRANT ALL PRIVILEGES ON blue_album.* TO 'blue_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. **æ–‡ä»¶æƒé™è®¾ç½®**

```bash
# è®¾ç½®é¡¹ç›®ç›®å½•æƒé™
sudo chown -R www-data:www-data /var/www/blue-local
sudo chmod -R 755 /var/www/blue-local

# å¯å†™ç›®å½•æƒé™
sudo chmod -R 775 /var/www/blue-local/uploads
sudo chmod -R 775 /var/www/blue-local/logs
```

---

## ğŸ“‹ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: è·¯å¾„é”™è¯¯

```python
# âŒ é”™è¯¯
FileNotFoundError: d:\uploads\file.jpg

# âœ… è§£å†³
# ä»£ç å·²ä½¿ç”¨ Path() è‡ªåŠ¨å¤„ç†
from backend.config import config
upload_dir = config.UPLOAD_DIR  # è‡ªåŠ¨é€‚é…å¹³å°
```

### é—®é¢˜2: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
sudo systemctl status mysql

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -tulpn | grep 3306

# æ£€æŸ¥ .env é…ç½®
cat .env | grep DB_

# æµ‹è¯•è¿æ¥
mysql -h 127.0.0.1 -u blue_user -p blue_album
```

### é—®é¢˜3: CORS é”™è¯¯

```bash
# æ£€æŸ¥ .env çš„ CORS_ORIGINS
cat .env | grep CORS_ORIGINS

# ç¡®ä¿åŒ…å«å‰ç«¯åŸŸå
CORS_ORIGINS=https://yourdomain.com,http://localhost:5173

# é‡å¯åç«¯æœåŠ¡
docker-compose restart backend
# æˆ–
sudo systemctl restart blue-local
```

### é—®é¢˜4: ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :8000
sudo lsof -i :3306

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>

# æˆ–ä¿®æ”¹ .env ä½¿ç”¨å…¶ä»–ç«¯å£
PORT=8001
```

### é—®é¢˜5: æƒé™ä¸è¶³

```bash
# ä¸Šä¼ æ–‡ä»¶å¤±è´¥
sudo chown -R www-data:www-data /var/www/blue-local/uploads
sudo chmod -R 775 /var/www/blue-local/uploads

# æ—¥å¿—å†™å…¥å¤±è´¥
sudo chown -R www-data:www-data /var/www/blue-local/logs
sudo chmod -R 775 /var/www/blue-local/logs
```

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å¿—

### æœ¬åœ°æµ‹è¯•é€šè¿‡

```powershell
# 1. ç¯å¢ƒéªŒè¯é€šè¿‡
python scripts\deployment\validate-environment.py
# âœ“ All checks passed

# 2. é…ç½®æ£€æµ‹æ­£ç¡®
python backend\config.py
# âœ“ Environment: development
# âœ“ Database: localhost:3306

# 3. å¯åŠ¨æˆåŠŸ
python -m uvicorn backend.main:app --reload
# âœ“ Application startup complete
```

### æœåŠ¡å™¨æµ‹è¯•é€šè¿‡

```bash
# 1. ç¯å¢ƒéªŒè¯é€šè¿‡
python3 scripts/deployment/validate-environment.py
# âœ“ All checks passed

# 2. é…ç½®æ£€æµ‹æ­£ç¡®
python3 backend/config.py
# âœ“ Environment: production
# âœ“ Database: 127.0.0.1:3306

# 3. Docker å¯åŠ¨æˆåŠŸ
docker-compose up -d
docker-compose logs
# âœ“ All services running

# 4. API å“åº”æ­£å¸¸
curl http://localhost:8000/api/health
# {"status": "ok", "environment": "production"}
```

---

## ğŸ¯ ä¸€é”®éƒ¨ç½²å‘½ä»¤

### Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# æœåŠ¡å™¨ç«¯ä¸€é”®éƒ¨ç½²
cd /var/www/blue-local
chmod +x scripts/deployment/deploy-docker.sh
./scripts/deployment/deploy-docker.sh
```

### ä¼ ç»Ÿéƒ¨ç½²

```bash
# æœåŠ¡å™¨ç«¯ä¼ ç»Ÿéƒ¨ç½²
cd /var/www/blue-local
chmod +x scripts/deployment/deploy.sh
./scripts/deployment/deploy.sh
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `backend/config.py` - ç¯å¢ƒè‡ªé€‚åº”é…ç½®
- `backend/database.py` - æ•°æ®åº“è¿æ¥ï¼ˆä½¿ç”¨ configï¼‰
- `scripts/deployment/validate-environment.py` - ç¯å¢ƒæ£€æµ‹è„šæœ¬
- `scripts/deployment/collect-deployment-files.ps1` - æ–‡ä»¶æ”¶é›†è„šæœ¬
- `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- `deployment-package/DEPLOYMENT_README.md` - éƒ¨ç½²è¯´æ˜

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æœ¬åœ°æ›´æ–°æ¨é€

```powershell
# æœ¬åœ°å¼€å‘å®Œæˆå
git add .
git commit -m "feat: new feature"
git push origin main

# æ¨é€åˆ°åŒæ­¥åˆ†æ”¯
.\scripts\sync\push-shared-branch.ps1
```

### æœåŠ¡å™¨ç«¯æ›´æ–°

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
cd /var/www/blue-local
git pull origin main

# Docker æ–¹å¼æ›´æ–°
docker-compose down
docker-compose up -d --build

# ä¼ ç»Ÿæ–¹å¼æ›´æ–°
sudo systemctl restart blue-local
sudo systemctl restart nginx
```

---

**æ ¸å¿ƒæ€æƒ³ï¼šå†™ä¸€æ¬¡ä»£ç ï¼Œè‡ªåŠ¨é€‚é…æ‰€æœ‰ç¯å¢ƒï¼** ğŸš€
